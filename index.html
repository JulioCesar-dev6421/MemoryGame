<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rick and Morty Memory Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --portal-green: #97ce4c; }
        body {
            background-color: #202329;
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            margin: 0;
            user-select: none;
            touch-action: manipulation;
        }
        
        #overlay {
            position: fixed;
            inset: 0;
            background: #202329;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.6s ease-in-out;
        }

        .portal-wrapper {
            position: relative;
            width: 260px;
            height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .portal-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            animation: portalRotate 10s linear infinite;
            filter: drop-shadow(0 0 20px #97ce4c);
        }

        .portal-text {
            position: absolute;
            color: white;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 10px #000;
            animation: pulseText 1.5s ease-in-out infinite;
            font-size: 1.2rem;
        }

        @keyframes portalRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulseText {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px; /* Padding levemente maior para as cartas respirarem */
            min-height: 0;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px; /* Aumentado de 8px para 10px para melhor visualização */
            width: 100%;
            height: 100%;
            max-width: 380px; /* Aumentado de 340px */
            max-height: 460px; /* Aumentado de 400px para cartas maiores */
        }

        .card { perspective: 1000px; height: 100%; cursor: pointer; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px; /* Bordas um pouco mais arredondadas */
            border: 2px solid var(--portal-green);
        }
        .card-front {
            background: #3c3e44 url('https://help.redbubble.com/hc/article_attachments/360002309526/Rick_and_Morty_Logo.png') no-repeat center;
            background-size: 85%;
        }
        .card-back {
            background: #3c3e44;
            transform: rotateY(180deg);
            overflow: hidden;
        }
        .card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .matched { 
            opacity: 0.2; 
            pointer-events: none; 
            border-color: white !important;
            box-shadow: 0 0 10px var(--portal-green);
        }

        #win-screen {
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body>

    <div id="overlay" onclick="startGame()">
        <div class="portal-wrapper">
            <img src="https://uce0cffb3a1a3d05c4069da7f7b7.dl.dropboxusercontent.com/cd/0/inline/C4ScbytDLnLX8oTtxnOfC3_RJmhVCpascHgRmMER4hjWdEYPUdd5Jws3GRvaIKO_Fzgq4EF6SK-ecVlbz2CyEa7B0fsz7AGhiykKKanUwrJc0Gx2hzpaGRi5y0VFLZHQ5QxFCVmJJHBnZdpqGvnzc203/file#" alt="Portal" class="portal-img">
            <span class="portal-text">Iniciar</span>
        </div>
        <p class="mt-4 text-[#97ce4c] font-bold text-[11px] animate-pulse uppercase tracking-widest">Toque para entrar no portal</p>
    </div>

    <header class="text-center py-2 shrink-0 bg-[#202329]/90 z-10">
        <div class="flex justify-between items-center px-5 mb-2">
            <div class="bg-black/60 px-3 py-1 rounded-full border border-white/10 text-[10px] font-bold">
                DIMENSÃO: <span id="lvl-display" class="text-[#97ce4c]">1</span>
            </div>
            <h1 class="text-sm font-black text-[#97ce4c] uppercase tracking-tighter">Memory Master</h1>
            <div class="bg-black/60 px-3 py-1 rounded-full border border-white/10 text-[10px] font-bold">
                CLICKS: <span id="c-count" class="text-blue-300">0</span>
            </div>
        </div>
        <div class="w-full bg-gray-800 h-1.5 overflow-hidden">
            <div id="progress-bar" class="bg-[#97ce4c] h-full transition-all duration-500 shadow-[0_0_10px_#97ce4c]" style="width: 0%"></div>
        </div>
    </header>

    <main>
        <div id="grid"></div>
    </main>

    <!-- Tela de Transição de Nível (Sem Recarregar a Página) -->
    <div id="win-screen" class="fixed inset-0 flex flex-col items-center justify-center hidden z-50 text-center p-6">
        <h2 class="text-4xl font-black text-[#97ce4c] mb-2 leading-none">WUBBA LUBBA<br>DUB DUB!</h2>
        <p class="text-white/70 text-[10px] mb-8 uppercase tracking-[0.3em]">Portal estabilizado...</p>
        <div class="w-32 h-32 mb-10">
            <img src="https://uce0cffb3a1a3d05c4069da7f7b7.dl.dropboxusercontent.com/cd/0/inline/C4ScbytDLnLX8oTtxnOfC3_RJmhVCpascHgRmMER4hjWdEYPUdd5Jws3GRvaIKO_Fzgq4EF6SK-ecVlbz2CyEa7B0fsz7AGhiykKKanUwrJc0Gx2hzpaGRi5y0VFLZHQ5QxFCVmJJHBnZdpqGvnzc203/file#" class="w-full h-full animate-spin">
        </div>
        <button id="next-level-btn" class="bg-[#97ce4c] text-black px-14 py-4 rounded-full font-black uppercase text-sm shadow-[0_0_40px_rgba(151,206,76,0.6)] active:scale-95 transition-transform">
            Próxima Dimensão
        </button>
    </div>

    <script>
        const THEME_URL = 'https://ucf13b09cc29c9a06735639a83b0.dl.dropboxusercontent.com/cd/0/inline/C4R5r3nrkSkoDGZQQDQ9da-NEFV9tE3z0ysXvpIkfn-ASUy5R-VQdDRGCLOtvp-3udSAfORoA6DxEXo4XWVog6XS6V5-Be2KwH42g6rd3aQ9-hEoAgQ_lRyM-thTgFQKPsoLtnRT8aMVKwfgfqIw1HSi/file#';
        const FLIP_URL = 'https://uc0c6f65e3a5eb777ce0bfe44162.dl.dropboxusercontent.com/cd/0/inline/C4Set4E1a1rW0UmtVHQuNHlarcJv-eECwAEXmrrSJ4qBkPhngo3TuCFxJrS5CnCLBTMmHfWBTPn4kSiwLfJyuz8j9LHe4BFnKOVt5Csw0ckozsbScKcBaq31bd8aPWvTGtnZSQ-HHH6ygQuQZUI67Cnu/file#';
        const MATCH_URL = 'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3';
        const WIN_SOUND = 'https://www.myinstants.com/media/sounds/rick-and-morty-wubba-lubba-dub-dub.mp3';

        const audio = {
            theme: new Audio(THEME_URL),
            flip: new Audio(FLIP_URL),
            match: new Audio(MATCH_URL),
            win: new Audio(WIN_SOUND)
        };

        audio.theme.loop = true;
        audio.theme.volume = 0.4;
        audio.flip.volume = 0.9;

        let level = 1;
        let flippedCards = [];
        let matches = 0;
        let attempts = 0;
        let isLock = false;

        function startGame() {
            audio.theme.play().catch(console.error);
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('overlay').style.display = 'none';
            }, 600);
            initLevel();
        }

        async function initLevel() {
            isLock = true;
            const grid = document.getElementById('grid');
            grid.innerHTML = '<div class="col-span-3 flex items-center justify-center text-[#97ce4c] font-black text-xs animate-pulse">SINTONIZANDO CIDADELA...</div>';
            
            matches = 0;
            flippedCards = [];
            attempts = 0;
            updateUI();

            try {
                // Página aleatória para personagens diferentes a cada nível
                const page = Math.floor(Math.random() * 42) + 1;
                const res = await fetch(`https://rickandmortyapi.com/api/character?page=${page}`);
                const data = await res.json();
                
                const selected = data.results.sort(() => 0.5 - Math.random()).slice(0, 6);
                const deck = [...selected, ...selected].sort(() => 0.5 - Math.random());
                
                grid.innerHTML = '';
                deck.forEach(char => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.dataset.id = char.id;
                    card.innerHTML = `
                        <div class="card-inner">
                            <div class="card-front"></div>
                            <div class="card-back">
                                <img src="${char.image}" alt="Rick and Morty Character">
                            </div>
                        </div>
                    `;
                    card.onclick = () => flipCard(card);
                    grid.appendChild(card);
                });
                isLock = false;
            } catch (e) {
                grid.innerHTML = '<div class="col-span-3 text-red-500 font-bold">ERRO NA CIDADELA: PORTAL INSTÁVEL</div>';
            }
        }

        function updateUI() {
            document.getElementById('c-count').innerText = attempts;
            document.getElementById('lvl-display').innerText = level;
            const progress = (matches / 6) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function flipCard(card) {
            if (isLock || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            // Som de virada do Dropbox
            audio.flip.currentTime = 0;
            audio.flip.play().catch(()=>{});

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                isLock = true;
                attempts++;
                
                const [c1, c2] = flippedCards;
                if (c1.dataset.id === c2.dataset.id) {
                    matches++;
                    updateUI();
                    
                    setTimeout(() => {
                        audio.match.currentTime = 0;
                        audio.match.play().catch(()=>{});
                        c1.classList.add('matched');
                        c2.classList.add('matched');
                        flippedCards = [];
                        isLock = false;
                        
                        if (matches === 6) {
                            setTimeout(showWinScreen, 600);
                        }
                    }, 500);
                } else {
                    setTimeout(() => {
                        c1.classList.remove('flipped');
                        c2.classList.remove('flipped');
                        flippedCards = [];
                        isLock = false;
                        updateUI();
                    }, 1000);
                }
            }
        }

        function showWinScreen() {
            audio.win.play().catch(()=>{});
            const screen = document.getElementById('win-screen');
            screen.classList.remove('hidden');
        }

        document.getElementById('next-level-btn').onclick = () => {
            level++;
            document.getElementById('win-screen').classList.add('hidden');
            initLevel();
        };

    </script>
</body>
</html>

